<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Christmas Countdown (Radio)</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<style>
body {
    margin: 0;
    padding: 0;
    font-family: 'Arial', sans-serif;
    overflow: hidden;
    height: 100vh;
    background: url('christmas-background.jpg') no-repeat center center fixed;
    background-size: cover;
    user-select: none;
}
#container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    transition: transform 0.05s ease;
}
#title, #subtitle {
    font-size: 6em;
    color: #fff;
    text-shadow: 0 0 15px red, 0 0 25px green;
    margin: 0;
    display: inline-block;
    transition: transform 0.05s ease;
}
#countdown {
    font-size: 6em;
    color: #fff;
    text-shadow: 0 0 10px red, 0 0 20px green;
    margin-top: 20px;
    display: inline-block;
    transition: transform 0.05s ease;
}
#playButton {
    margin-top: 50px;
    font-size: 2em;
    padding: 15px 30px;
    background-color: red;
    color: white;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    text-shadow: 1px 1px 2px #000;
    transition: transform 0.2s;
}
#playButton:hover { transform: scale(1.1); }
.snowflake {
    position: absolute;
    top: -10px;
    color: white;
    font-size: 1em;
    user-select: none;
    pointer-events: none;
    animation: fall linear infinite;
}
@keyframes fall { to { transform: translateY(100vh); } }
</style>
</head>
<body>
<div id="container">
    <h1 id="title">Christmas</h1>
    <h1 id="subtitle">Countdown</h1>
    <div id="countdown">00d 00h 00m 00s</div>
    <button id="playButton">Start Live Radio</button>
</div>

<script>
const countdownEl = document.getElementById('countdown');
const titleEl = document.getElementById('title');
const subtitleEl = document.getElementById('subtitle');
const container = document.getElementById('container');

// --- Audio Setup ---
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let analyser, dataArray;
let songGain, speechGain;

// Track list
const songs = [
    "All I Want For Christmas Is You","Baby It's Cold Outside","Blue Christmas",
    "Carol Of The Bells","Christmas (Baby Please Come Home)","Christmas Canon",
    "Dance Of The Sugar Plum Fairy","Deck The Halls","Do You Want To Build A Snowman",
    "Feliz Navidad","Frosty The Snowman","God Rest Ye Merry Gentlemen","Hallelujah",
    "Here Comes Santa Claus","Holly Jolly Christmas","I Want A Hippopotamus For Christmas",
    "It's Beginning To Look A Lot Like Christmas","It's The Most Wonderful Time Of The Year",
    "Jingle Bell Rock","Jingle Bells","Last Christmas","Let It Snow! Let It Snow!",
    "Little Drummer Boy","Mistletoe","O Christmas Tree","Rockin Around The Christmas Tree",
    "Rudolph The Red-Nosed Reindeer","Santa Baby","Santa Claus Is Comin' To Town",
    "Silent Night","Sleigh Ride","The Christmas Song","The Nutcracker March",
    "Up On The Housetop","We Wish You A Merry Christmas","White Christmas",
    "Winter Wonderland","Wonderful Christmastime","Your A Mean One Mr Grinch",
];

const playlist = songs.map(song => ({name: song, src: `songs/Music Now, Trap Music Now, Dance Music Now - ${song} (SPOTISAVER).mp3`}));
const speechTrack = {name:"Speech", src:"songs/speech.mp3"};

let songBuffers = [];
let speechBuffer = null;

// Countdown
function updateCountdown(){
    const now = new Date();
    let year = now.getFullYear();
    let target = new Date(`Dec 25, ${year} 00:00:00`).getTime();
    if(now.getTime() > target) target = new Date(`Dec 25, ${year+1} 00:00:00`).getTime();
    const distance = target - now.getTime();
    const days = Math.floor(distance/(1000*60*60*24));
    const hours = Math.floor((distance % (1000*60*60*24))/(1000*60*60));
    const minutes = Math.floor((distance % (1000*60*60))/(1000*60));
    const seconds = Math.floor((distance % (1000*60))/1000);
    countdownEl.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
}
setInterval(updateCountdown,1000);
updateCountdown();

// Snowflakes
for(let i=0;i<50;i++){
    const snow = document.createElement('div');
    snow.className='snowflake';
    snow.textContent='❄';
    snow.style.left=Math.random()*100+'vw';
    snow.style.animationDuration=(3+Math.random()*5)+'s';
    snow.style.fontSize=(10+Math.random()*20)+'px';
    document.body.appendChild(snow);
}

// Animate container/text + background brightness
function animateEffects(){
    requestAnimationFrame(animateEffects);
    if(!analyser) return;

    analyser.getByteFrequencyData(dataArray);
    const avg = dataArray.reduce((a,b)=>a+b,0)/dataArray.length;

    const scale = 1 + avg/1000;
    const xShake = (Math.random()-0.5)*avg/50;
    const yShake = (Math.random()-0.5)*avg/50;
    container.style.transform = `scale(${scale}) translate(${xShake}px,${yShake}px)`;

    const brightness = 1 + avg/500;
    document.body.style.filter = `brightness(${brightness})`;
    document.body.style.backgroundSize = `${100 + avg/5}% ${100 + avg/5}%`;

    titleEl.style.transform = `scale(${1 + avg/1200}) translate(${xShake/2}px,${yShake/2}px)`;
    subtitleEl.style.transform = `scale(${1 + avg/1200}) translate(${xShake/2}px,${yShake/2}px)`;
    countdownEl.style.transform = `scale(${1 + avg/1400}) translate(${xShake/2}px,${yShake/2}px)`;

    document.querySelectorAll('.snowflake').forEach((flake,i)=>{
        flake.style.transform = `translateY(${Math.sin(Date.now()/1000+i)*5 + avg/15}px)`;
        flake.style.opacity = 0.5 + avg/512;
    });
}

// --- Load audio buffers ---
async function loadAudioBuffer(url){
    const response = await fetch(url);
    const arrayBuffer = await response.arrayBuffer();
    return audioCtx.decodeAudioData(arrayBuffer);
}

async function preloadAll(){
    for(let track of playlist){
        const buffer = await loadAudioBuffer(track.src);
        songBuffers.push(buffer);
    }
    speechBuffer = await loadAudioBuffer(speechTrack.src);
}

// --- Play tracks like live radio ---
let currentIndex = 0;
let songSource = null;
let speechSource = null;
let songStartTime = 0;

function scheduleNextSong(startOffset=0){
    songSource = audioCtx.createBufferSource();
    songSource.buffer = songBuffers[currentIndex];

    songGain = audioCtx.createGain();
    songGain.gain.value = 1;

    analyser = audioCtx.createAnalyser();
    dataArray = new Uint8Array(analyser.frequencyBinCount);

    songSource.connect(songGain).connect(analyser).connect(audioCtx.destination);

    songStartTime = audioCtx.currentTime - startOffset;
    songSource.start(0, startOffset);

    // Schedule speech near end
    const duration = songSource.buffer.duration;
    const speechTime = duration - 5; // play speech 5s before end
    if(speechBuffer){
        speechSource = audioCtx.createBufferSource();
        speechSource.buffer = speechBuffer;
        speechGain = audioCtx.createGain();
        speechGain.gain.value = 0;
        speechSource.connect(speechGain).connect(audioCtx.destination);

        setTimeout(()=>{
            songGain.gain.setValueAtTime(0.6, audioCtx.currentTime);
            speechGain.gain.setValueAtTime(1, audioCtx.currentTime);
            speechSource.start();
            speechSource.onended = ()=>{
                songGain.gain.setValueAtTime(1, audioCtx.currentTime);
                speechGain.gain.setValueAtTime(0, audioCtx.currentTime);
            };
        }, speechTime * 1000);
    }

    // Schedule next song
    setTimeout(()=>{
        currentIndex = (currentIndex + 1) % songBuffers.length;
        scheduleNextSong(0);
    }, (duration - startOffset) * 1000);
}

// --- Block media keys & controls ---
function blockControls(){
    if('mediaSession' in navigator){
        ['play','pause','previoustrack','nexttrack','stop','seekbackward','seekforward','seekto'].forEach(a=>{
            navigator.mediaSession.setActionHandler(a,null);
        });
    }
    window.addEventListener('contextmenu', e=> e.preventDefault());
    window.addEventListener('keydown', e=>{
        if(e.ctrlKey || e.metaKey || e.key === "F5") e.preventDefault();
        if(["MediaPlayPause","MediaTrackNext","MediaTrackPrevious","MediaStop"].includes(e.code)) e.preventDefault();
    });
}

// --- Start live radio ---
document.getElementById('playButton').addEventListener('click', async ()=>{
    if(audioCtx.state === 'suspended') await audioCtx.resume();
    await preloadAll();

    // Determine “live” position based on date
    const now = new Date().getTime();
    const start = new Date("Dec 1, 2025 00:00:00").getTime();
    let elapsed = Math.max(0,(now - start)/1000);

    // Sum durations to find current track
    let sum = 0;
    let liveIndex = 0;
    for(let i=0;i<songBuffers.length;i++){
        if(sum + songBuffers[i].duration > elapsed){
            liveIndex = i;
            break;
        }
        sum += songBuffers[i].duration;
    }
    const offset = elapsed - sum;
    currentIndex = liveIndex;

    scheduleNextSong(offset);
    animateEffects();
    blockControls();
    document.getElementById('playButton').style.display='none';
});
</script>
</body>
</html>
