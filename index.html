<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Christmas Countdown Radio</title>

<style>
:root { --glow: 0 0 15px red, 0 0 25px green; }
html,body { margin:0; padding:0; height:100%; width:100%; font-family:Arial,sans-serif; overflow:hidden; }
#bg { position:fixed; inset:0; background:url('christmas-background.jpg') center/cover no-repeat; z-index:-1; }
#container { display:flex; flex-direction:column; justify-content:center; align-items:center; height:100%; text-align:center; }
#title,#subtitle { font-size:clamp(2.5rem,8vw,6rem); color:#fff; text-shadow:var(--glow); margin:0; }
#countdown { font-size:clamp(2rem,6vw,5rem); color:#fff; margin-top:1rem; }
#playButton { margin-top:2rem; font-size:1.5rem; padding:1rem 2rem; background:red; color:white; border:none; border-radius:16px; }
#nowPlaying { color:white; margin-top:1rem; font-size:1.3rem; }
</style>
</head>

<body>
<div id="bg"></div>

<div id="container">
  <h1 id="title">Christmas</h1>
  <h1 id="subtitle">Countdown</h1>
  <div id="countdown"></div>
  <button id="playButton">Start Live Radio</button>
  <div id="nowPlaying"></div>
</div>

<!-- BACKGROUND-SAFE PLAYER -->
<audio id="radio" playsinline></audio>

<script>
/* ================= CONFIG ================= */

const RADIO_START = new Date("Dec 1, 2025 00:00:00").getTime();

const SONG_NAMES = [
  "All I Want For Christmas Is You",
  "Baby It's Cold Outside",
  "Blue Christmas",
  "Carol Of The Bells",
  "Christmas (Baby Please Come Home)",
  "Christmas Canon",
  "Deck The Halls",
  "Do You Want To Build A Snowman",
  "Feliz Navidad",
  "Frosty The Snowman",
  "God Rest Ye Merry Gentlemen",
  "Here Comes Santa Claus",
  "Holly Jolly Christmas",
  "I Want A Hippopotamus For Christmas",
  "It's Beginning To Look A Lot Like Christmas",
  "It's The Most Wonderful Time Of The Year",
  "Jingle Bell Rock",
  "Jingle Bells",
  "Last Christmas",
  "Let It Snow! Let It Snow!",
  "Little Drummer Boy",
  "Mistletoe",
  "O Christmas Tree",
  "Rockin Around The Christmas Tree",
  "Rudolph The Red-Nosed Reindeer",
  "Santa Baby",
  "Santa Claus Is Comin' To Town",
  "Silent Night",
  "Sleigh Ride",
  "The Christmas Song",
  "Up On The Housetop",
  "We Wish You A Merry Christmas",
  "White Christmas",
  "Winter Wonderland",
  "Wonderful Christmastime",
  "You're A Mean One, Mr. Grinch",
  "speech"
];

const FILES = SONG_NAMES.map(n =>
  n === "speech" ? "songs/speech.mp3" : `songs/${n}.mp3`
);

/* ================= DOM ================= */

const audio = document.getElementById("radio");
const playBtn = document.getElementById("playButton");
const nowPlaying = document.getElementById("nowPlaying");
const bg = document.getElementById("bg");

/* ================= AUDIO CONTEXT ================= */

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const analyser = audioCtx.createAnalyser();
analyser.fftSize = 64;
const dataArray = new Uint8Array(analyser.frequencyBinCount);

const sourceNode = audioCtx.createMediaElementSource(audio);
sourceNode.connect(analyser).connect(audioCtx.destination);

/* ================= EXACT DURATIONS ================= */

const durations = [];

async function getDuration(src){
  return new Promise(resolve=>{
    const a = new Audio();
    a.src = encodeURI(src);
    a.preload = "metadata";
    a.onloadedmetadata = () => resolve(a.duration);
  });
}

async function loadDurations(){
  for(const file of FILES){
    durations.push(await getDuration(file));
  }
}

/* ================= LIVE POSITION ================= */

function getLivePosition(){
  const elapsed = (Date.now() - RADIO_START) / 1000;
  const total = durations.reduce((a,b)=>a+b,0);
  let t = elapsed % total;

  for(let i=0;i<durations.length;i++){
    if(t < durations[i]) return { index:i, offset:t };
    t -= durations[i];
  }
  return { index:0, offset:0 };
}

/* ================= PLAYBACK ================= */

function playIndex(i, offset=0){
  audio.src = encodeURI(FILES[i]);
  audio.currentTime = offset;
  audio.play();
  nowPlaying.textContent = SONG_NAMES[i] === "speech"
    ? "Now Playing: Speech"
    : "Now Playing: " + SONG_NAMES[i];
}

audio.onended = () => {
  currentIndex = (currentIndex + 1) % FILES.length;
  playIndex(currentIndex);
};

let currentIndex = 0;

/* ================= VISUALIZER ================= */

function animate(){
  requestAnimationFrame(animate);
  analyser.getByteFrequencyData(dataArray);
  const avg = dataArray.reduce((a,b)=>a+b,0)/dataArray.length;
  bg.style.transform = `scale(${1 + avg/9000})`;
  bg.style.filter = `brightness(${1 - avg/400})`;
}
animate();

/* ================= START ================= */

playBtn.onclick = async () => {
  playBtn.style.display = "none";
  await audioCtx.resume();
  await loadDurations();
  const pos = getLivePosition();
  currentIndex = pos.index;
  playIndex(pos.index, pos.offset);
};
</script>
</body>
</html>