<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Christmas Countdown (Radio)</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<style>
:root { --glow: 0 0 15px red, 0 0 25px green; }

html, body {
  margin: 0; padding: 0; height: 100%; width: 100%;
  font-family: Arial, sans-serif; overflow: hidden;
}

#bg {
  position: fixed; top:0; left:0;
  width:100%; height:100%;
  background-image: url('christmas-background.jpg');
  background-position: center center;
  background-repeat: no-repeat;
  background-size: cover;
  z-index: -1;
  will-change: transform, filter;
  transform-origin: center center;
}

#container {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100%; text-align: center;
}

#title, #subtitle {
  font-size: clamp(2.5rem, 8vw, 6rem);
  color: #fff;
  text-shadow: var(--glow);
  margin: 0;
  transform-origin: center;
}

#countdown {
  font-size: clamp(2rem, 6vw, 5rem);
  color: #fff;
  text-shadow: 0 0 10px red, 0 0 20px green;
  margin-top: 1rem;
  transform-origin: center;
}

/* Song name display */
#songName {
  font-size: clamp(1.2rem, 4vw, 2rem);
  color: #ffeb3b;
  text-shadow: 0 0 8px #fff, 0 0 12px #ff0000, 0 0 20px #00ff00;
  margin-top: 1rem;
  max-width: 90vw;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-weight: bold;
}

#playButton {
  margin-top: 2rem;
  font-size: clamp(1.2rem, 4vw, 2rem);
  padding: 1rem 2rem;
  background-color: red;
  color: white;
  border: none;
  border-radius: 16px;
  cursor: pointer;
  text-shadow: 1px 1px 2px #000;
}

.snowflake {
  position: absolute;
  top: -10px;
  color: white;
  user-select: none;
  pointer-events: none;
  animation: fall linear infinite;
}

@keyframes fall { to { transform: translateY(110vh); } }

@media (max-width: 768px) { .snowflake { opacity: 0.7; } }
</style>
</head>
<body>

<div id="bg"></div>
<div id="container">
  <h1 id="title">Christmas</h1>
  <h1 id="subtitle">Countdown</h1>
  <div id="countdown">00d 00h 00m 00s</div>
  <div id="songName">ðŸŽµ Waiting for music...</div>
  <button id="playButton">Start Live Radio</button>
</div>

<script>
/* ---------------- CONFIG ---------------- */
const RADIO_START = new Date("Dec 1, 2025 00:00:00").getTime();
const SONG_NAMES = [
  "All I Want For Christmas Is You","Baby It's Cold Outside","Blue Christmas","Carol Of The Bells",
  "Christmas (Baby Please Come Home)","Christmas Canon","Deck The Halls","Do You Want To Build A Snowman",
  "Feliz Navidad","Frosty The Snowman","God Rest Ye Merry Gentlemen","Here Comes Santa Claus",
  "Holly Jolly Christmas","I Want A Hippopotamus For Christmas","It's Beginning To Look A Lot Like Christmas",
  "It's The Most Wonderful Time Of The Year","Jingle Bell Rock","Jingle Bells","Last Christmas",
  "Let It Snow! Let It Snow!","Little Drummer Boy","Mistletoe","O Christmas Tree",
  "Rockin Around The Christmas Tree","Rudolph The Red-Nosed Reindeer","Santa Baby",
  "Santa Claus Is Comin' To Town","Silent Night","Sleigh Ride","The Christmas Song",
  "Up On The Housetop","We Wish You A Merry Christmas","White Christmas","Winter Wonderland",
  "Wonderful Christmastime","You're A Mean One, Mr. Grinch"
];
const PLAYLIST = SONG_NAMES.map(n=>`songs/Music Now, Trap Music Now, Dance Music Now - ${n} (SPOTISAVER).mp3`);
const SPEECH_SRC = "songs/speech.mp3";

const countdownEl = document.getElementById("countdown");
const titleEl = document.getElementById("title");
const subtitleEl = document.getElementById("subtitle");
const songNameEl = document.getElementById("songName");
const bgEl = document.getElementById("bg");

let audioCtx;
let durations = [];
let buffers = []; // store loaded AudioBuffers
let speechBuffer = null;
let globalSongIndex = 0;
let analyser;
let dataArray;

/* ---------------- COUNTDOWN ---------------- */
function updateCountdown() {
  const now = new Date();
  const year = now.getFullYear();
  const christmas = new Date(`Dec 25, ${year} 00:00:00`);
  const newYear = new Date(`Jan 1, ${year + 1} 00:00:00`);
  if (now>=christmas && now<newYear) {
    countdownEl.textContent=""; titleEl.textContent="Merry"; subtitleEl.textContent="Christmas";
    return;
  }
  const targetYear = now>=newYear ? year+1 : year;
  const target = new Date(`Dec 25, ${targetYear} 00:00:00`).getTime();
  const d = target-now.getTime();
  const days=Math.floor(d/86400000), hours=Math.floor((d%86400000)/3600000),
        minutes=Math.floor((d%3600000)/60000), seconds=Math.floor((d%60000)/1000);
  countdownEl.textContent=`${days}d ${hours}h ${minutes}m ${seconds}s`;
}
setInterval(updateCountdown,1000); updateCountdown();

/* ---------------- SNOW ---------------- */
const snowCount = window.innerWidth<768?25:50;
for(let i=0;i<snowCount;i++){
  const s=document.createElement("div"); s.className="snowflake"; s.textContent="â„";
  s.style.left=Math.random()*100+"vw";
  s.style.fontSize=10+Math.random()*20+"px";
  s.style.animationDuration=5+Math.random()*6+"s";
  document.body.appendChild(s);
}

/* ---------------- AUDIO UTILS ---------------- */
async function loadBuffer(src){
  try {
    const res = await fetch(src);
    if(!res.ok) throw new Error("HTTP "+res.status);
    const buf = await res.arrayBuffer();
    return await audioCtx.decodeAudioData(buf);
  } catch(e) {
    console.error("Failed to load audio:", src, e);
    return null;
  }
}

/* ---------------- LIVE RADIO ---------------- */
async function playLive(index, offset=0){
  let buffer = buffers[index];
  if(!buffer) {
    buffer = await loadBuffer(PLAYLIST[index]);
    if(!buffer) return;
    buffers[index] = buffer;
    durations[index] = buffer.duration;
  }

  // Show song name
  songNameEl.textContent = "ðŸŽµ " + SONG_NAMES[index];

  const source = audioCtx.createBufferSource();
  source.buffer = buffer;
  const gain = audioCtx.createGain();
  source.connect(gain).connect(audioCtx.destination);

  if(!analyser){
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 64;
    dataArray = new Uint8Array(analyser.frequencyBinCount);
    source.connect(analyser).connect(audioCtx.destination);
  } else {
    source.connect(analyser).connect(audioCtx.destination);
  }

  source.start(0, offset);

  // Play speech every 3 songs
  if((globalSongIndex+1)%3===0){
    if(!speechBuffer) speechBuffer = await loadBuffer(SPEECH_SRC);
    const delay = Math.max(0, buffer.duration-offset-5);
    setTimeout(()=>{
      gain.gain.value = 0.6;
      const s = audioCtx.createBufferSource();
      s.buffer = speechBuffer;
      s.connect(audioCtx.destination);
      s.start();
      s.onended = ()=>gain.gain.value = 1;
    }, delay*1000);
  }

  // Preload next song in background
  const nextIndex = (index+1)%PLAYLIST.length;
  if(!buffers[nextIndex]) loadBuffer(PLAYLIST[nextIndex]).then(b=>{if(b){buffers[nextIndex]=b; durations[nextIndex]=b.duration;}});

  // Schedule next song
  setTimeout(()=>{
    globalSongIndex = nextIndex;
    playLive(nextIndex, 0);
  }, (buffer.duration - offset)*1000);
}

/* ---------------- START ---------------- */
document.getElementById("playButton").onclick = async ()=>{
  document.getElementById("playButton").style.display = "none";
  audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  await audioCtx.resume();

  // Preload first song
  const firstBuffer = await loadBuffer(PLAYLIST[0]);
  if(!firstBuffer){ alert("Failed to load first song."); return; }
  buffers[0] = firstBuffer;
  durations[0] = firstBuffer.duration;

  // Preload speech
  speechBuffer = await loadBuffer(SPEECH_SRC);

  // Start playback immediately
  globalSongIndex = 0;
  playLive(0,0);

  // Preload remaining songs in background
  for(let i=1;i<PLAYLIST.length;i++){
    loadBuffer(PLAYLIST[i]).then(buf=>{if(buf){buffers[i]=buf; durations[i]=buf.duration;}});
  }
};

/* ---------------- BOUNCE & DARKEN ---------------- */
function animateEffects(){
  requestAnimationFrame(animateEffects);
  if(!analyser) return;
  analyser.getByteFrequencyData(dataArray);
  const avg = dataArray.reduce((a,b)=>a+b,0)/dataArray.length;

  // Background bounce
  const bgScale = 1 + avg/8000; 
  bgEl.style.transform = `scale(${bgScale})`;

  // Background brightness pulse
  const brightness = 1 - Math.min(avg/300, 0.5);
  bgEl.style.filter = `brightness(${brightness})`;

  // Text bounce
  const textScale = 1 + avg/2000;
  titleEl.style.transform=`scale(${textScale})`;
  subtitleEl.style.transform=`scale(${textScale})`;
  countdownEl.style.transform=`scale(${textScale})`;

  // Device vibration
  if(navigator.vibrate && avg > 100) navigator.vibrate(12);
}
animateEffects();
</script>
</body>
</html>