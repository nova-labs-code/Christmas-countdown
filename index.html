<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Christmas Live Radio</title>
<style>
html, body {
  margin:0;
  padding:0;
  height:100%;
  width:100%;
  font-family:Arial,Helvetica,sans-serif;
  overflow:hidden;
  background:black;
}
#bg {
  position:fixed;
  inset:0;
  background:url("./christmas-background.jpg") center/cover no-repeat;
  z-index:-1;
  transform:scale(1);
  filter:brightness(1);
}
#container {
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  height:100%;
  text-align:center;
}
#title {
  font-size:3rem;
  text-shadow:0 0 15px red,0 0 25px green;
}
#countdown {
  font-size:2rem;
  margin-top:1rem;
}
#nowPlaying {
  margin-top:1.5rem;
  font-size:1.2rem;
  opacity:.9;
}
button {
  margin-top:2rem;
  padding:1rem 2rem;
  font-size:1.2rem;
  border:none;
  border-radius:14px;
  background:red;
  color:white;
  cursor:pointer;
}
</style>
</head>
<body>
<div id="bg"></div>
<div id="container">
  <div id="title">Christmas Live Radio</div>
  <div id="countdown">Loadingâ€¦</div>
  <div id="nowPlaying"></div>
  <button id="start">Start Live Radio</button>
</div>

<!-- hidden audio element -->
<audio id="audio" playsinline></audio>

<script>
/* ================= CONFIG ================= */
const RADIO_START = new Date("Dec 1, 2025 00:00:00").getTime();
const FILE_PREFIX = "Music Now, Trap Music Now, Dance Music Now - ";
const FILE_SUFFIX = " (SPOTISAVER).mp3";

const SONG_NAMES = [
  "All I Want For Christmas Is You",
  "Baby It's Cold Outside",
  "Blue Christmas",
  "Carol Of The Bells",
  "Christmas (Baby Please Come Home)",
  "Christmas Canon",
  "Deck The Halls",
  "Do You Want To Build A Snowman",
  "Feliz Navidad",
  "Frosty The Snowman",
  "God Rest Ye Merry Gentlemen",
  "Here Comes Santa Claus",
  "Holly Jolly Christmas",
  "I Want A Hippopotamus For Christmas",
  "It's Beginning To Look A Lot Like Christmas",
  "It's The Most Wonderful Time Of The Year",
  "Jingle Bell Rock",
  "Jingle Bells",
  "Last Christmas",
  "Let It Snow! Let It Snow!",
  "Little Drummer Boy",
  "Mistletoe",
  "O Christmas Tree",
  "Rockin Around The Christmas Tree",
  "Rudolph The Red-Nosed Reindeer",
  "Santa Baby",
  "Santa Claus Is Comin' To Town",
  "Silent Night",
  "Sleigh Ride",
  "The Christmas Song",
  "Up On The Housetop",
  "We Wish You A Merry Christmas",
  "White Christmas",
  "Winter Wonderland",
  "Wonderful Christmastime",
  "You're A Mean One, Mr. Grinch",
  "speech"
];

/* ================= HELPERS ================= */
function filePath(name){
  if(name==="speech") return "songs/speech.mp3";
  return encodeURI("songs/" + FILE_PREFIX + name + FILE_SUFFIX);
}

/* ================= COUNTDOWN ================= */
const countdown = document.getElementById("countdown");
function updateCountdown(){
  const now = new Date();
  const year = now.getFullYear();
  const target = new Date(`Dec 25, ${year} 00:00:00`);
  const diff = target - now;
  if(diff <= 0){
    countdown.textContent = "Merry Christmas!";
    return;
  }
  const d = Math.floor(diff/86400000);
  const h = Math.floor(diff%86400000/3600000);
  const m = Math.floor(diff%3600000/60000);
  const s = Math.floor(diff%60000/1000);
  countdown.textContent = `${d}d ${h}h ${m}m ${s}s`;
}
setInterval(updateCountdown,1000);
updateCountdown();

/* ================= AUDIO ================= */
const audio = document.getElementById("audio");
const startBtn = document.getElementById("start");
const nowPlaying = document.getElementById("nowPlaying");
const bg = document.getElementById("bg");

let ctx, analyser, data, durations=[], index=0;

/* duration loader */
function getDuration(src){
  return new Promise(res=>{
    const a = new Audio();
    a.src = encodeURI(src);
    a.preload="metadata";
    a.onloadedmetadata=()=>res(a.duration||240);
    a.onerror=()=>res(240);
  });
}

async function loadDurations(){
  for(const n of SONG_NAMES){
    durations.push(await getDuration(filePath(n)));
  }
}

/* ================= PLAYBACK ================= */
function playTrack(i, offset=0){
  audio.src = filePath(SONG_NAMES[i]);
  audio.currentTime = offset;
  audio.play();
  nowPlaying.textContent = SONG_NAMES[i]==="speech"?"Speech":SONG_NAMES[i];
  console.log("Playing:", audio.src);
}

audio.onended = ()=>{
  index = (index + 1) % SONG_NAMES.length;
  playTrack(index,0);
};

/* ================= VISUALIZER ================= */
function animate(){
  requestAnimationFrame(animate);
  if(!analyser) return;
  analyser.getByteFrequencyData(data);
  const avg = data.reduce((a,b)=>a+b,0)/data.length;

  // only scale, do NOT darken image
  const scale = 1 + avg/10000; // subtle pulse
  bg.style.transform = `scale(${scale})`;
}

animate(); // start visualizer animation loop

/* ================= START ================= */
startBtn.onclick = async ()=>{
  startBtn.remove();

  ctx = new (window.AudioContext||window.webkitAudioContext)();
  analyser = ctx.createAnalyser();
  analyser.fftSize = 64;
  data = new Uint8Array(analyser.frequencyBinCount);

  const source = ctx.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(ctx.destination);

  await loadDurations();

  let elapsed = (Date.now() - RADIO_START)/1000;
  const total = durations.reduce((a,b)=>a+b,0);
  elapsed = ((elapsed % total)+total)%total;

  let sum=0;
  for(let i=0;i<durations.length;i++){
    if(sum+durations[i]>elapsed){
      index=i;
      playTrack(i, elapsed - sum);
      break;
    }
    sum += durations[i];
  }
};
</script>
</body>
</html>